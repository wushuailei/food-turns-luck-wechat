<!--菜谱表单页-->
<view class="container">
    <view class="form-section">
        <!-- 菜谱名称 -->
        <view class="form-item">
            <view class="label required">菜谱名称</view>
            <t-input 
                placeholder="请输入菜谱名称" 
                value="{{formData.name}}"
                bind:change="onNameChange"
            />
        </view>

        <!-- 菜谱描述 -->
        <view class="form-item">
            <view class="label">菜谱描述</view>
            <t-textarea 
                placeholder="请输入菜谱描述" 
                value="{{formData.description}}"
                bind:change="onDescChange"
                maxlength="500"
            />
        </view>

        <!-- 封面图片 -->
        <view class="form-item">
            <view class="label">封面图片</view>
            <view class="cover-upload">
                <image 
                    wx:if="{{formData.cover_image_key}}" 
                    class="cover-preview" 
                    src="{{formData.cover_image_key}}" 
                    mode="aspectFill"
                />
                <view class="upload-btn" bind:tap="uploadCover">
                    {{formData.cover_image_key ? '更换图片' : '上传图片'}}
                </view>
            </view>
        </view>

        <!-- 步骤类型 -->
        <view class="form-item">
            <view class="label required">步骤类型</view>
            <t-radio-group value="{{formData.step_type}}" bind:change="onStepTypeChange">
                <t-radio value="custom" label="自定义步骤" />
                <t-radio value="link" label="链接引用" />
            </t-radio-group>
        </view>

        <!-- 自定义步骤 -->
        <view class="form-item" wx:if="{{formData.step_type === 'custom'}}">
            <view class="label">制作步骤</view>
            <view class="steps-editor">
                <view class="step-item" wx:for="{{steps}}" wx:key="index">
                    <view class="step-header">
                        <text class="step-num">步骤 {{index + 1}}</text>
                        <text class="step-delete" bind:tap="deleteStep" data-index="{{index}}">删除</text>
                    </view>
                    <t-textarea 
                        placeholder="请输入步骤内容" 
                        value="{{item}}"
                        bind:change="onStepChange"
                        data-index="{{index}}"
                    />
                </view>
                <t-button theme="light" size="large" bind:tap="addStep">
                    + 添加步骤
                </t-button>
            </view>
        </view>

        <!-- 链接 -->
        <view class="form-item" wx:if="{{formData.step_type === 'link'}}">
            <view class="label">参考链接</view>
            <view class="links-editor">
                <view class="link-item" wx:for="{{links}}" wx:key="index">
                    <t-input 
                        placeholder="请输入链接地址" 
                        value="{{item}}"
                        bind:change="onLinkChange"
                        data-index="{{index}}"
                    />
                    <text class="link-delete" bind:tap="deleteLink" data-index="{{index}}">删除</text>
                </view>
                <t-button theme="light" size="large" bind:tap="addLink">
                    + 添加链接
                </t-button>
            </view>
        </view>

        <!-- 标签 -->
        <view class="form-item">
            <view class="label">标签</view>
            <view class="tags-selector">
                <t-tag 
                    wx:for="{{allTags}}" 
                    wx:key="index"
                    theme="{{selectedTags.includes(item) ? 'primary' : 'default'}}"
                    bind:tap="toggleTag"
                    data-tag="{{item}}"
                >
                    {{item}}
                </t-tag>
            </view>
        </view>

        <!-- 是否公开 -->
        <view class="form-item">
            <view class="label-row">
                <text class="label">公开菜谱</text>
                <t-switch value="{{formData.is_public}}" bind:change="onPublicChange" />
            </view>
            <view class="hint">公开后其他用户可以查看此菜谱</view>
        </view>
    </view>

    <!-- 底部按钮 -->
    <view class="action-bar">
        <t-button theme="primary" size="large" bind:tap="onSubmit" loading="{{submitting}}">
            {{isEdit ? '保存' : '创建'}}
        </t-button>
    </view>
</view>
